<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omin | Command System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --black: #000000;
            --dark: #0a0a0a;
            --border: #1a1a1a;
            --border-light: #2a2a2a;
            --gray: #64748b;
            --white: #f1f5f9;
            --green: #10b981;
            --amber: #f59e0b;
            --red: #ef4444;
            --blue: #3b82f6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'SF Pro Text', system-ui, sans-serif;
            background: var(--black);
            color: var(--white);
            line-height: 1.6;
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0;
        }

        /* Demo Banner */
        .demo-banner {
            background: rgba(245, 158, 11, 0.15);
            border-bottom: 1px solid var(--amber);
            padding: 12px 20px;
            text-align: center;
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: 11px;
            letter-spacing: 0.05em;
            color: var(--amber);
            font-weight: 600;
        }

        /* Classification Bar */
        .classification-bar {
            background: var(--dark);
            border-bottom: 2px solid var(--green);
            padding: 8px 20px;
            text-align: center;
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: 11px;
            letter-spacing: 0.1em;
            color: var(--green);
            font-weight: 700;
        }

        /* Role Header */
        .role-header {
            background: var(--dark);
            border-bottom: 1px solid var(--border);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .role-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .arbiter-logo {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .role-selector {
            display: flex;
            gap: 8px;
        }

        .role-btn {
            padding: 8px 16px;
            background: transparent;
            color: var(--gray);
            border: 1px solid var(--border-light);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .role-btn:hover {
            border-color: var(--amber);
            color: var(--amber);
        }

        .role-btn.active {
            background: var(--amber);
            color: var(--black);
            border-color: var(--amber);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--green);
            font-weight: 600;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--green);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Views */
        .views-container {
            position: relative;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Steps */
        .steps {
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 24px 20px;
            background: var(--dark);
            border-bottom: 1px solid var(--border);
        }

        .step {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-light);
            transition: all 0.3s;
        }

        .step.active-step {
            background: var(--amber);
            box-shadow: 0 0 12px rgba(245, 158, 11, 0.5);
        }

        /* Battery Commander View */
        .battery-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--white);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            background: var(--dark);
            border: 1px solid var(--border-light);
            color: var(--white);
            font-size: 14px;
            font-family: inherit;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--amber);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .action-button {
            width: 100%;
            padding: 16px;
            background: var(--amber);
            color: var(--black);
            border: none;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-button:hover {
            background: #d97706;
            transform: translateY(-2px);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-light);
            border-top-color: var(--amber);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 8px;
        }

        .loading-subtext {
            font-family: 'SF Mono', monospace;
            font-size: 24px;
            color: var(--amber);
            font-weight: 700;
        }

        .hidden {
            display: none !important;
        }

        /* Results */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--dark);
            border: 1px solid var(--border-light);
            margin-bottom: 20px;
            font-size: 12px;
        }

        .results-meta {
            color: var(--gray);
        }

        .results-timing {
            color: var(--green);
            font-family: 'SF Mono', monospace;
        }

        .results {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .recommendation {
            border: 1px solid var(--border-light);
            background: var(--dark);
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .recommendation:hover {
            border-color: var(--amber);
        }

        .recommendation.selected {
            border-color: var(--amber);
            background: rgba(245, 158, 11, 0.05);
        }

        .rec-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .rec-rank {
            font-family: 'SF Mono', monospace;
            font-size: 11px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .rec-rank.top-rank {
            color: var(--green);
            font-weight: 700;
        }

        .rec-coherence {
            font-family: 'SF Mono', monospace;
            font-size: 18px;
            font-weight: 700;
        }

        .coherence-high {
            color: var(--green);
        }

        .coherence-medium {
            color: var(--amber);
        }

        .coherence-low {
            color: var(--gray);
        }

        .rec-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--white);
        }

        .rec-description {
            font-size: 13px;
            line-height: 1.6;
            color: var(--gray);
            white-space: pre-line;
        }

        .rec-meta {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
            font-size: 11px;
        }

        .meta-item {
            display: flex;
            gap: 6px;
        }

        .meta-label {
            color: var(--gray);
        }

        .meta-value {
            color: var(--white);
            font-weight: 600;
        }

        /* Execute Section */
        .execute-section {
            max-width: 800px;
            margin: 0 auto;
        }

        .execute-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .radio-command {
            background: var(--dark);
            border: 1px solid var(--border-light);
            padding: 20px;
            font-family: 'SF Mono', monospace;
            font-size: 13px;
            line-height: 1.8;
            color: var(--green);
            white-space: pre-line;
            margin-bottom: 24px;
        }

        .button-group {
            display: flex;
            gap: 12px;
        }

        .secondary-button {
            flex: 1;
            padding: 16px;
            background: transparent;
            color: var(--white);
            border: 1px solid var(--border-light);
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .secondary-button:hover {
            border-color: var(--amber);
            color: var(--amber);
        }

        .primary-button {
            flex: 2;
            padding: 16px;
            background: var(--amber);
            color: var(--black);
            border: none;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .primary-button:hover {
            background: #d97706;
        }

        /* Mission Results */
        .mission-success-section {
            max-width: 800px;
            margin: 0 auto;
        }

        .success-header {
            text-align: center;
            padding: 40px 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 32px;
        }

        .success-icon {
            font-size: 48px;
            color: var(--green);
            margin-bottom: 16px;
        }

        .success-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .success-subtitle {
            font-size: 14px;
            color: var(--gray);
        }

        .mission-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--dark);
            border: 2px solid var(--border-light);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-card.stat-critical {
            border: 2px solid var(--border-light);
            background: rgba(16, 185, 129, 0.05);
        }

        .stat-label {
            font-size: 11px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'SF Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-detail {
            font-size: 12px;
            color: var(--gray);
        }

        .stat-check {
            font-size: 12px;
            color: var(--green);
            font-weight: 600;
        }

        .debrief-section {
            background: var(--dark);
            border: 1px solid var(--border-light);
            padding: 24px;
            margin-bottom: 24px;
        }

        .debrief-title {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 20px;
        }

        .debrief-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .debrief-item {
            text-align: center;
        }

        .debrief-label {
            font-size: 11px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .debrief-value {
            font-family: 'SF Mono', monospace;
            font-size: 20px;
            font-weight: 700;
            color: var(--white);
        }

        .debrief-success {
            color: var(--green);
        }

        .debrief-conclusion {
            font-size: 13px;
            line-height: 1.6;
            color: var(--gray);
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .debrief-conclusion strong {
            color: var(--white);
        }

        /* Timer */
        .timer {
            position: fixed;
            top: 120px;
            right: 40px;
            background: var(--dark);
            border: 2px solid var(--red);
            padding: 20px;
            text-align: center;
            min-width: 120px;
        }

        .timer-label {
            font-size: 11px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        #battery-timer-display {
            font-family: 'SF Mono', monospace;
            font-size: 32px;
            font-weight: 700;
            color: var(--red);
        }

        /* Theater View */
        .theater-layout {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            min-height: calc(100vh - 120px);
        }

        .left-sidebar {
            background: var(--dark);
            border-right: 1px solid var(--border);
            padding: 24px;
        }

        .sidebar-section {
            margin-bottom: 32px;
        }

        .sidebar-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 20px;
            color: var(--amber);
        }

        .resource-region {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            padding: 16px;
            margin-bottom: 12px;
        }

        .region-name {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--white);
        }

        .resource-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 12px;
        }

        .resource-label {
            color: var(--gray);
        }

        .resource-value {
            font-family: 'SF Mono', monospace;
            font-weight: 600;
            color: var(--white);
        }

        .center-area {
            padding: 24px;
        }

        .theater-map {
            background: var(--dark);
            border: 1px solid var(--border);
            padding: 24px;
            margin-bottom: 24px;
        }

        .map-title {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 20px;
        }

        .threat-wave {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid var(--red);
            padding: 16px;
            margin-bottom: 16px;
        }

        .wave-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .wave-title {
            font-family: 'SF Mono', monospace;
            font-size: 11px;
            font-weight: 700;
            color: var(--red);
            letter-spacing: 0.05em;
        }

        .wave-time {
            font-family: 'SF Mono', monospace;
            font-size: 11px;
            color: var(--gray);
        }

        .wave-details {
            font-size: 13px;
            line-height: 1.6;
            color: var(--gray);
        }

        .wave-details strong {
            color: var(--white);
        }

        .strategy-section {
            background: var(--dark);
            border: 1px solid var(--border);
            padding: 24px;
        }

        .strategy-title {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 20px;
        }

        .strategy-input {
            margin-bottom: 20px;
        }

        .theater-input-label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .theater-input-field {
            width: 100%;
            padding: 10px 12px;
            background: var(--black);
            border: 1px solid var(--border-light);
            color: var(--white);
            font-size: 13px;
        }

        .theater-input-field:focus {
            outline: none;
            border-color: var(--amber);
        }

        .calculate-button {
            width: 100%;
            padding: 14px;
            background: var(--amber);
            color: var(--black);
            border: none;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calculate-button:hover {
            background: #d97706;
        }

        .right-sidebar {
            background: var(--dark);
            border-left: 1px solid var(--border);
            padding: 24px;
            overflow-y: auto;
        }

        .recommendations-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 20px;
            color: var(--amber);
        }

        .theater-rec {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .theater-rec:hover {
            border-color: var(--amber);
        }

        .theater-rec.selected {
            border-color: var(--amber);
            background: rgba(245, 158, 11, 0.05);
        }

        .theater-rec-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .theater-rec-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--white);
        }

        .theater-rec-score {
            font-family: 'SF Mono', monospace;
            font-size: 13px;
            font-weight: 700;
            color: var(--green);
        }

        .theater-rec-summary {
            font-size: 12px;
            line-height: 1.5;
            color: var(--gray);
            margin-bottom: 12px;
        }

        .theater-rec-meta {
            display: flex;
            gap: 16px;
            font-size: 11px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .theater-meta-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .theater-meta-label {
            color: var(--gray);
        }

        .theater-meta-value {
            font-weight: 600;
            color: var(--white);
        }

        .action-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--dark);
            border-top: 2px solid var(--amber);
            padding: 20px;
            display: none;
            z-index: 200;
        }

        .action-panel.visible {
            display: block;
        }

        .action-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .action-text {
            font-size: 14px;
        }

        .action-strategy {
            color: var(--amber);
            font-weight: 600;
        }

        .btn {
            padding: 12px 24px;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-secondary {
            background: transparent;
            color: var(--white);
            border: 1px solid var(--border-light);
        }

        .btn-secondary:hover {
            border-color: var(--amber);
            color: var(--amber);
        }

        .btn-primary {
            background: var(--amber);
            color: var(--black);
            margin-left: 12px;
        }

        .btn-primary:hover {
            background: #d97706;
        }

        .theater-loading {
            text-align: center;
            padding: 40px;
        }

        .theater-results {
            text-align: center;
            padding: 60px 40px;
        }

        .theater-success-header {
            margin-bottom: 32px;
        }

        .theater-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .regional-results {
            background: var(--dark);
            border: 1px solid var(--border-light);
            padding: 24px;
            margin-bottom: 24px;
        }

        .regional-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 16px;
        }

        .regional-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .regional-item {
            text-align: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
        }

        .regional-name {
            font-size: 11px;
            color: var(--gray);
            margin-bottom: 8px;
        }

        .regional-result {
            font-size: 12px;
            color: var(--green);
            font-weight: 600;
        }

        @media (max-width: 1200px) {
            .theater-layout {
                grid-template-columns: 1fr;
            }

            .left-sidebar,
            .right-sidebar {
                display: none;
            }

            .timer {
                display: none;
            }

            .mission-stats {
                grid-template-columns: 1fr;
            }

            .debrief-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .input-row {
                grid-template-columns: 1fr;
            }

            .rec-meta {
                flex-direction: column;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Demo Banner -->
    <div class="demo-banner">
        INVESTOR DEMO • SIMULATED RESPONSES BASED ON OPERATIONAL DATA
    </div>

    <!-- Classification bar -->
    <div class="classification-bar">
        CLASSIFIED // OMIN COMMAND SYSTEM
    </div>

    <!-- Role selector header -->
    <div class="role-header">
        <div class="role-left">
            <div class="arbiter-logo">Omin</div>
            <div class="role-selector">
                <button class="role-btn active" onclick="switchRole('battery')">Battery Commander</button>
                <button class="role-btn" onclick="switchRole('theater')">Theater Operations</button>
            </div>
        </div>
        <div class="status-indicator">
            <div class="status-dot"></div>
            <span>System Ready</span>
        </div>
    </div>

    <!-- Views container -->
    <div class="views-container">
        <!-- ==================== BATTERY COMMANDER VIEW ==================== -->
        <div id="battery-view" class="view active">
            <div class="steps">
                <div class="step active-step" id="battery-step1"></div>
                <div class="step" id="battery-step2"></div>
                <div class="step" id="battery-step3"></div>
            </div>

            <div class="battery-container">
                <!-- Step 1: Input -->
                <div id="battery-input" class="section">
                    <div class="section-title">Step 1: Detected Threat</div>

                    <div class="input-group">
                        <label class="input-label">Threat Type</label>
                        <select class="input-field" id="threat-type">
                            <option value="">Select type...</option>
                            <option value="Shahed-136">Shahed-136 (Iranian UAV)</option>
                            <option value="Lancet">Lancet (FPV Kamikaze)</option>
                            <option value="Geran">Geran-2 (Russian Modification)</option>
                        </select>
                    </div>

                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">Count</label>
                            <input type="number" class="input-field" id="threat-count" value="4" min="1">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Range (km)</label>
                            <input type="number" class="input-field" id="threat-range" value="22" min="0" step="0.1">
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Probable Target</label>
                        <select class="input-field" id="threat-target">
                            <option value="">Select target...</option>
                            <option value="ammo">Ammunition Depot (CRITICAL)</option>
                            <option value="command">Command Post</option>
                            <option value="energy">Energy Infrastructure</option>
                        </select>
                    </div>

                    <button class="action-button" onclick="processBatteryInput()">Calculate Recommendation</button>
                </div>

                <!-- Step 2: Loading -->
                <div id="battery-loading" class="loading hidden">
                    <div class="spinner"></div>
                    <div class="loading-text">Omin processing scenario...</div>
                    <div class="loading-subtext">
                        <span id="battery-loading-time">0.0</span>s
                    </div>
                </div>

                <!-- Step 3: Results -->
                <div id="battery-results" class="hidden">
                    <div class="section">
                        <div class="section-title">Step 2: Omin Recommendations</div>
                    </div>
                    <div class="results-header">
                        <div class="results-meta">
                            <div>Generated <span id="results-count">6</span> strategies</div>
                            <div style="margin-top: 4px;">Coherence scores: 0.52 - 0.82</div>
                        </div>
                        <div class="results-timing">
                            Processing: <span id="results-time">0.8</span>s
                        </div>
                    </div>
                    <div class="results" id="battery-recommendations"></div>
                </div>

                <!-- Step 4: Execute -->
                <div id="battery-execute" class="hidden">
                    <div class="execute-section">
                        <div class="execute-title">Step 3: Execute Command</div>
                        <div class="radio-command" id="battery-radio-command"></div>
                        <div class="button-group">
                            <button class="secondary-button" onclick="batteryGoBack()">Back</button>
                            <button class="primary-button" onclick="batteryExecute()">Execute</button>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Mission Results -->
                <div id="battery-mission-results" class="hidden">
                    <div class="mission-success-section">
                        <div class="success-header">
                            <div class="success-icon">✓</div>
                            <div class="success-title">Operation Completed Successfully</div>
                            <div class="success-subtitle">Strategy executed according to Omin recommendation</div>
                        </div>

                        <div class="mission-stats">
                            <div class="stat-card stat-critical">
                                <div class="stat-label">Threats Neutralized</div>
                                <div class="stat-value" id="result-threats">4/4 Shahed-136</div>
                                <div class="stat-check">✓ Complete intercept</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-label">Resources Used</div>
                                <div class="stat-value" id="result-cost">$1.0M</div>
                                <div class="stat-detail" id="result-systems">2x IRIS-T missiles</div>
                            </div>

                            <div class="stat-card">
                                <div class="stat-label">Reserves Maintained</div>
                                <div class="stat-value" id="result-reserve">68%</div>
                                <div class="stat-detail">Ready for next waves</div>
                            </div>
                        </div>

                        <div class="debrief-section">
                            <div class="debrief-title">Omin Decision Validation</div>
                            <div class="debrief-grid">
                                <div class="debrief-item">
                                    <div class="debrief-label">Strategy Coherence</div>
                                    <div class="debrief-value" id="result-coherence">0.8021</div>
                                </div>
                                <div class="debrief-item">
                                    <div class="debrief-label">Omin success forecast</div>
                                    <div class="debrief-value" id="result-predicted">88%</div>
                                </div>
                                <div class="debrief-item">
                                    <div class="debrief-label">Actual result</div>
                                    <div class="debrief-value debrief-success">100%</div>
                                </div>
                                <div class="debrief-item">
                                    <div class="debrief-label">Execution time</div>
                                    <div class="debrief-value" id="result-time">3min 24s</div>
                                </div>
                            </div>
                            <div class="debrief-conclusion">
                                <strong>Conclusion:</strong> Strategy with highest coherence (0.80+) ensured optimal result.
                                Omin forecast confirmed by actual mission execution.
                            </div>
                        </div>

                        <button class="action-button" onclick="resetBattery()">Try another scenario</button>
                    </div>
                </div>
            </div>

            <!-- Timer -->
            <div class="timer hidden" id="battery-timer">
                <div class="timer-label">Time to impact</div>
                <div id="battery-timer-display">7:00</div>
            </div>
        </div>

        <!-- ==================== THEATER COMMANDER VIEW ==================== -->
        <div id="theater-view" class="view">
            <div class="theater-layout">
                <!-- Left sidebar -->
                <div class="left-sidebar">
                    <div class="sidebar-section">
                        <div class="sidebar-title">Air Defense Resources</div>

                        <div class="resource-region">
                            <div class="region-name">Mykolaiv Region</div>
                            <div class="resource-item">
                                <span class="resource-label">IRIS-T</span>
                                <span class="resource-value">16/16</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">Buk-M1</span>
                                <span class="resource-value">12/18</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">Status</span>
                                <span class="resource-value" style="color: var(--green);">READY</span>
                            </div>
                        </div>

                        <div class="resource-region">
                            <div class="region-name">Odesa Region</div>
                            <div class="resource-item">
                                <span class="resource-label">Patriot</span>
                                <span class="resource-value">16/16</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">IRIS-T</span>
                                <span class="resource-value">24/32</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">Status</span>
                                <span class="resource-value" style="color: var(--green);">READY</span>
                            </div>
                        </div>

                        <div class="resource-region" style="border-color: var(--amber);">
                            <div class="region-name">Total Resources</div>
                            <div class="resource-item">
                                <span class="resource-label">Total Missiles</span>
                                <span class="resource-value" style="color: var(--amber);">120</span>
                            </div>
                            <div class="resource-item">
                                <span class="resource-label">Resupply</span>
                                <span class="resource-value">36 hours</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Center area -->
                <div class="center-area">
                    <div class="theater-map">
                        <div class="map-title">Operational Situation</div>

                        <div class="threat-wave">
                            <div class="wave-header">
                                <div class="wave-title">WAVE 1 • ACTIVE</div>
                                <div class="wave-time">23:15 UTC</div>
                            </div>
                            <div class="wave-details">
                                <strong>Mykolaiv:</strong> 4x Shahed-136, 22km, target: ammunition depot<br/>
                                <strong>Priority:</strong> CRITICAL
                            </div>
                        </div>

                        <div class="threat-wave" style="opacity: 0.6;">
                            <div class="wave-header">
                                <div class="wave-title">WAVE 2 • EXPECTED</div>
                                <div class="wave-time">~00:30 UTC</div>
                            </div>
                            <div class="wave-details">
                                <strong>Intelligence:</strong> 20-30 targets, multiple directions<br/>
                                <strong>Time:</strong> 1-1.5 hours
                            </div>
                        </div>
                    </div>

                    <div class="strategy-section">
                        <div class="strategy-title">Strategic Request to Omin</div>

                        <div class="strategy-input">
                            <label class="theater-input-label">Planning Horizon</label>
                            <select class="theater-input-field" id="planning-horizon">
                                <option value="all-night">All night (6 hours)</option>
                                <option value="3-hours">3 hours</option>
                            </select>
                        </div>

                        <div class="strategy-input">
                            <label class="theater-input-label">Acceptable Risk (%)</label>
                            <input type="range" class="theater-input-field" id="risk-tolerance" min="0" max="30" value="10"
                                   oninput="document.getElementById('risk-value').textContent = this.value + '%'">
                            <div style="text-align: center; margin-top: 4px; font-family: monospace; color: var(--amber);">
                                <span id="risk-value">10%</span>
                            </div>
                        </div>

                        <button class="calculate-button" onclick="calculateTheaterStrategy()">
                            Calculate Strategy
                        </button>
                    </div>
                </div>

                <!-- Right sidebar -->
                <div class="right-sidebar">
                    <div class="recommendations-title">Strategic Recommendations</div>
                    <div id="theater-recommendations">
                        <div style="text-align: center; padding: 40px 20px; color: var(--gray); font-size: 12px;">
                            Click "Calculate Strategy"
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action panel -->
            <div class="action-panel" id="theater-action-panel">
                <div class="action-content">
                    <div class="action-text">
                        Selected: <span class="action-strategy" id="theater-selected-strategy">-</span>
                    </div>
                    <div>
                        <button class="btn btn-secondary" onclick="theaterViewDetails()">Details</button>
                        <button class="btn btn-primary" onclick="theaterApproveDirective()">Approve Directive</button>
                    </div>
                </div>
            </div>

            <!-- Theater Loading -->
            <div id="theater-loading" class="theater-loading hidden">
                <div class="spinner"></div>
                <div class="loading-text">Omin processing theater scenario...</div>
                <div class="loading-subtext">
                    <span id="theater-loading-time">0.0</span>s
                </div>
            </div>

            <!-- Theater Results -->
            <div id="theater-results" class="theater-results hidden">
                <div class="theater-success-header">
                    <div class="success-icon">✓</div>
                    <div class="success-title">Directive approved and executed</div>
                    <div class="success-subtitle">Theater strategy implemented across all regions</div>
                </div>

                <div class="theater-stats">
                    <div class="stat-card stat-critical">
                        <div class="stat-label">Night Defense</div>
                        <div class="stat-value" id="theater-result-waves">4/5 waves</div>
                        <div class="stat-check">✓ 80% interception</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Total Cost</div>
                        <div class="stat-value" id="theater-result-cost">$4.2M</div>
                        <div class="stat-detail" id="theater-result-regions">3 regions protected</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Reserve</div>
                        <div class="stat-value" id="theater-result-reserve">65%</div>
                        <div class="stat-detail">Ready for next day</div>
                    </div>
                </div>

                <div class="regional-results">
                    <div class="regional-title">Regional Results</div>
                    <div class="regional-grid">
                        <div class="regional-item">
                            <div class="regional-name">Mykolaiv region</div>
                            <div class="regional-result">✓ 4/4 threats</div>
                        </div>

                        <div class="regional-item">
                            <div class="regional-name">Odesa region</div>
                            <div class="regional-result">✓ Reserve maintained</div>
                        </div>

                        <div class="regional-item">
                            <div class="regional-name">Kherson region</div>
                            <div class="regional-result">✓ EW Coordination</div>
                        </div>
                    </div>
                </div>

                <div class="debrief-section">
                    <div class="debrief-title">Theater Strategy Validation</div>
                    <div class="debrief-grid">
                        <div class="debrief-item">
                            <div class="debrief-label">Strategy Coherence</div>
                            <div class="debrief-value">0.8367</div>
                        </div>
                        <div class="debrief-item">
                            <div class="debrief-label">Forecast</div>
                            <div class="debrief-value">78%</div>
                        </div>
                        <div class="debrief-item">
                            <div class="debrief-label">Actual</div>
                            <div class="debrief-value debrief-success">80%</div>
                        </div>
                        <div class="debrief-item">
                            <div class="debrief-label">Duration</div>
                            <div class="debrief-value">6h 45min</div>
                        </div>
                    </div>
                    <div class="debrief-conclusion">
                        <strong>Conclusion:</strong> Theater strategy with coherence 0.83+ ensured optimal balance
                        between protecting critical assets and preserving operational reserves. Omin forecast confirmed
                        by night defense results.
                    </div>
                </div>

                <div class="button-group">
                    <button class="secondary-button" onclick="closeTheaterResults()">Close</button>
                    <button class="action-button" onclick="resetTheater()">New Strategy</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentRole = 'battery';
        let selectedBatteryRec = null;
        let selectedTheaterRec = null;

        // Role switching
        function switchRole(role) {
            currentRole = role;

            // Update buttons
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById(role + '-view').classList.add('active');
        }

        // ==================== BATTERY COMMANDER ====================

        function processBatteryInput() {
            const threatType = document.getElementById('threat-type').value;
            const threatCount = parseInt(document.getElementById('threat-count').value);
            const threatRange = parseFloat(document.getElementById('threat-range').value);
            const threatTarget = document.getElementById('threat-target').value;

            if (!threatType || !threatCount || !threatRange || !threatTarget) {
                alert('Please fill all fields');
                return;
            }

            // Hide input, show loading
            document.getElementById('battery-input').classList.add('hidden');
            document.getElementById('battery-loading').classList.remove('hidden');
            document.getElementById('battery-step1').classList.remove('active-step');
            document.getElementById('battery-step2').classList.add('active-step');

            // Show timer
            document.getElementById('battery-timer').classList.remove('hidden');
            startBatteryTimer(7 * 60); // 7 minutes

            // Simulate processing
            let time = 0;
            const interval = setInterval(() => {
                time += 0.1;
                document.getElementById('battery-loading-time').textContent = time.toFixed(1);

                if (time >= 0.8) {
                    clearInterval(interval);
                    showBatteryRecommendations(threatType, threatCount, threatRange, threatTarget);
                }
            }, 100);
        }

        function showBatteryRecommendations(threatType, threatCount, threatRange, threatTarget) {
            const recommendations = [];

            const targetDesc = threatTarget === 'ammo' ? 'Ammunition Depot (400 tons)' :
                              threatTarget === 'command' ? 'Command Post' :
                              'Energy Infrastructure';

            // Calculate optimal range
            const optimalRange = 12;
            const waitTime = Math.round((threatRange - optimalRange) / 185 * 60);

            // Option 1: Wait for optimal range (highest coherence)
            recommendations.push({
                rank: 1,
                coherence: 0.8021,
                title: `Wait ${waitTime} minutes until optimal range`,
                description: `Wait ${waitTime} minutes until range ${optimalRange}km:\n• 2x IRIS-T on ${threatCount}x ${threatType}\n• Higher effectiveness at medium range (88%)\n• Maintain reserve: 4x IRIS-T, 3x Buk-M1, 8x Stinger\n• If breakthrough: Buk-M1 ready\n\nADVANTAGES:\n• 88% effectiveness (higher than long range)\n• Saving expensive missiles\n• Multiple defense layers\n\nRISKS:\n• Less time for reattack if miss\n• Threat closer to protected asset`,
                template_id: 'wait_optimal',
                estimated_cost: 1000000,
                estimated_success_rate: 88,
                time: `${waitTime}min`
            });

            // Option 2: Immediate long-range engagement
            recommendations.push({
                rank: 2,
                coherence: 0.7654,
                title: 'Immediate long-range engagement',
                description: `Use IRIS-T now at maximum range:\n• ${threatCount}x IRIS-T on ${threatCount}x ${threatType}\n• Engagement distance: ${threatRange}km\n• Time to launch: 2-3 minutes\n• Maintain reserve: 2x IRIS-T, all other systems\n\nADVANTAGES:\n• Destroy threat at maximum distance\n• More time for reattack if miss\n• Protecting ${targetDesc}\n\nRISKS:\n• Lower effectiveness at long range (82% vs 92% at close range)\n• Spending expensive missiles`,
                template_id: 'immediate_long',
                estimated_cost: 2000000,
                estimated_success_rate: 82,
                time: '2-3min'
            });

            // Option 3: Layered defense
            recommendations.push({
                rank: 3,
                coherence: 0.7234,
                title: 'Layered defense (3 levels)',
                description: `Three defense levels with different systems:\n• LEVEL 1 (5km): 4x Stinger - first attempt\n• LEVEL 2 (12km): 2x Buk-M1 - if breakthrough\n• LEVEL 3 (20km): 2x IRIS-T - last reserve\n\nADVANTAGES:\n• Multiple intercept chances\n• Use cheap systems first\n• Save most expensive for critical moments\n\nRISKS:\n• Complex three-level coordination\n• Rely on less reliable systems first`,
                template_id: 'layered',
                estimated_cost: 600000,
                estimated_success_rate: 75,
                time: 'Variable'
            });

            // Option 4: Request brigade coordination
            recommendations.push({
                rank: 4,
                coherence: 0.6789,
                title: 'Request coordination with brigade',
                description: `Coordination with brigade for optimal resource allocation:\n• My usage: MINIMAL - Stinger reserve\n• Request support from: Adjacent battery, EW support\n• Expected response time: 3-4 minutes\n\nMY CONTRIBUTION:\n• Stinger + Buk-M1 - ready to use after coordination\n• Preserving 85% reserve\n\nCOORDINATION ENABLES:\n• Optimal resource distribution across batteries\n• Avoid duplication of effort\n• Preserve my limited resources\n\nRISKS:\n• Coordination time: 3-4 minutes (threat at ${threatRange}km)\n• Support may not arrive in time`,
                template_id: 'coordination',
                estimated_cost: 300000,
                estimated_success_rate: 70,
                time: '3-4min response'
            });

            // Option 5: Maximum protection (overspending)
            recommendations.push({
                rank: 5,
                coherence: 0.5891,
                title: 'Maximum protection (possible overspending)',
                description: `Use MAXIMUM available resources:\n• 6x IRIS-T (use 100%)\n• 3x Buk-M1 (reserve)\n• All auxiliary systems ready\n\nRATIONALE:\n• Target "${targetDesc}" has CRITICAL priority\n• Guaranteed protection more important than preserving ammunition\n• ${threatCount} threats require maximum response\n\nADVANTAGES:\n• 94% probability of complete threat elimination\n• Maximum confidence in defense\n\nCRITICAL RISKS:\n• Spending 75% of night ammunition on one threat\n• Minimal reserve remains for subsequent attacks`,
                template_id: 'maximum',
                estimated_cost: 3000000,
                estimated_success_rate: 94,
                time: '2min'
            });

            // Option 6: Minimal engagement (lowest coherence)
            recommendations.push({
                rank: recommendations.length + 1,
                coherence: 0.5123,
                title: 'Minimal engagement (preserve reserves)',
                description: `Minimize use of expensive systems:\n• 2x Buk-M1 interception attempt\n• IRIS-T preserve for more critical threats\n• Accept risk of partial breakthrough\n\nRATIONALE:\n• Expected 2-3 subsequent attack waves tonight\n• Ammunition resupply in 24+ hours\n• Need to preserve capability for entire night\n\nHIGH RISKS:\n• Only 68% probability of successful interception\n• Possible damage to target "${targetDesc}"\n• Command may not approve minimal approach`,
                template_id: 'minimal_engagement',
                estimated_cost: 200000,
                estimated_success_rate: 68,
                time: '3-4min'
            });

            // Sort by coherence (descending)
            recommendations.sort((a, b) => b.coherence - a.coherence);

            // Display recommendations
            const container = document.getElementById('battery-recommendations');
            container.innerHTML = '';

            recommendations.forEach((rec, i) => {
                const coherenceClass = rec.coherence >= 0.75 ? 'coherence-high' :
                                     rec.coherence >= 0.65 ? 'coherence-medium' :
                                     'coherence-low';

                const div = document.createElement('div');
                div.className = 'recommendation';
                div.onclick = () => selectBatteryRecommendation(rec, div);
                div.innerHTML = `
                    <div class="rec-header">
                        <div class="rec-rank ${i === 0 ? 'top-rank' : ''}">Recommendation #${rec.rank} ${i === 0 ? '(OPTIMAL)' : ''}</div>
                        <div class="rec-coherence ${coherenceClass}">${rec.coherence.toFixed(4)}</div>
                    </div>
                    <div class="rec-title">${rec.title}</div>
                    <div class="rec-description">${rec.description}</div>
                    <div class="rec-meta">
                        <div class="meta-item">
                            <span class="meta-label">Cost</span>
                            <span class="meta-value">$${(rec.estimated_cost / 1000000).toFixed(1)}M</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Success</span>
                            <span class="meta-value">${rec.estimated_success_rate}%</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Time</span>
                            <span class="meta-value">${rec.time}</span>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });

            // Update UI
            document.getElementById('battery-loading').classList.add('hidden');
            document.getElementById('battery-results').classList.remove('hidden');
            document.getElementById('results-count').textContent = recommendations.length;
            document.getElementById('results-time').textContent = '0.8';
        }

        function selectBatteryRecommendation(rec, element) {
            // Remove previous selection
            document.querySelectorAll('.recommendation').forEach(el => {
                el.classList.remove('selected');
            });

            // Select new
            element.classList.add('selected');
            selectedBatteryRec = rec;

            // Move to execute step
            setTimeout(() => {
                document.getElementById('battery-results').classList.add('hidden');
                document.getElementById('battery-execute').classList.remove('hidden');
                document.getElementById('battery-step2').classList.remove('active-step');
                document.getElementById('battery-step3').classList.add('active-step');

                // Generate radio command
                const threatCount = parseInt(document.getElementById('threat-count').value);
                const threatType = document.getElementById('threat-type').value;

                let command = `Callsign Falcon-1, Falcon-2:
• Selected strategy: ${selectedBatteryRec.title}
• ${threatCount}x ${threatType}, azimuth 015
`;

                if (rec.template_id === 'wait_optimal') {
                    command += `• AWAITING range 12km (${Math.round((22 - 12) / 185 * 60)} minutes)
• Then launch: 2x IRIS-T missiles`;
                } else if (rec.template_id === 'immediate_long') {
                    command += `• Immediate launch at current range
• ${Math.min(threatCount, 4)}x IRIS-T missiles`;
                } else if (rec.template_id === 'layered') {
                    command += `• Level 1: Stinger ready (5km)
• Level 2: Buk-M1 ready (12km)
• Level 3: IRIS-T reserve (20km)`;
                } else if (rec.template_id === 'coordination') {
                    command += `• Request coordination with brigade
• Awaiting response: 3-4 minutes
• Our systems ready`;
                } else if (rec.template_id === 'maximum') {
                    command += `• MAXIMUM engagement
• 6x IRIS-T + 3x Buk-M1 ready
• All systems combat ready`;
                } else {
                    command += `• Minimal engagement
• 2x Buk-M1 only
• IRIS-T reserved for next waves`;
                }

                command += `\n\nConfirm execution.`;

                document.getElementById('battery-radio-command').textContent = command;
            }, 500);
        }

        function batteryGoBack() {
            document.getElementById('battery-execute').classList.add('hidden');
            document.getElementById('battery-results').classList.remove('hidden');
            document.getElementById('battery-step3').classList.remove('active-step');
            document.getElementById('battery-step2').classList.add('active-step');
        }

        function batteryExecute() {
            // Simulate execution
            document.getElementById('battery-execute').classList.add('hidden');

            setTimeout(() => {
                document.getElementById('battery-timer').classList.add('hidden');
                document.getElementById('battery-mission-results').classList.remove('hidden');

                // Fill in results based on selected strategy
                const threatCount = parseInt(document.getElementById('threat-count').value);
                const threatType = document.getElementById('threat-type').value;

                let systemsUsed = '2x IRIS-T missiles';
                if (selectedBatteryRec.template_id === 'maximum') {
                    systemsUsed = '6x IRIS-T + 3x Buk-M1';
                } else if (selectedBatteryRec.template_id === 'minimal_engagement') {
                    systemsUsed = '2x Buk-M1';
                } else if (selectedBatteryRec.template_id === 'coordination') {
                    systemsUsed = 'Coordination with brigade';
                }

                const reservePercent = Math.round(selectedBatteryRec.coherence * 85); // 0.8 coherence → ~68% reserves

                document.getElementById('result-threats').textContent = `${threatCount}/${threatCount} ${threatType}`;
                document.getElementById('result-cost').textContent = `$${(selectedBatteryRec.estimated_cost / 1000000).toFixed(1)}M`;
                document.getElementById('result-systems').textContent = systemsUsed;
                document.getElementById('result-reserve').textContent = `${reservePercent}%`;
                document.getElementById('result-coherence').textContent = selectedBatteryRec.coherence.toFixed(4);
                document.getElementById('result-predicted').textContent = `${selectedBatteryRec.estimated_success_rate}%`;

                let engagementTime = '3min 24s';
                if (selectedBatteryRec.template_id === 'wait_optimal') {
                    engagementTime = `${Math.round((22 - 12) / 185 * 60)}min 45s`;
                } else if (selectedBatteryRec.template_id === 'immediate_long') {
                    engagementTime = '2min 15s';
                } else if (selectedBatteryRec.template_id === 'layered') {
                    engagementTime = '4min 30s';
                }

                document.querySelectorAll('#result-time').forEach(el => {
                    el.textContent = engagementTime;
                });
            }, 2000);
        }

        function resetBattery() {
            // Reset all
            document.getElementById('battery-mission-results').classList.add('hidden');
            document.getElementById('battery-input').classList.remove('hidden');
            document.getElementById('battery-step3').classList.remove('active-step');
            document.getElementById('battery-step1').classList.add('active-step');
            selectedBatteryRec = null;
        }

        function startBatteryTimer(seconds) {
            const display = document.getElementById('battery-timer-display');
            let remaining = seconds;

            const interval = setInterval(() => {
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                display.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                remaining--;

                if (remaining < 0) {
                    clearInterval(interval);
                }
            }, 1000);
        }

        // ==================== THEATER OPERATIONS ====================

        function calculateTheaterStrategy() {
            const horizon = document.getElementById('planning-horizon').value;
            const risk = document.getElementById('risk-tolerance').value;

            // Hide center area, show loading
            document.querySelector('.theater-map').style.display = 'none';
            document.querySelector('.strategy-section').style.display = 'none';
            document.getElementById('theater-loading').classList.remove('hidden');

            // Simulate processing
            let time = 0;
            const interval = setInterval(() => {
                time += 0.1;
                document.getElementById('theater-loading-time').textContent = time.toFixed(1);

                if (time >= 1.2) {
                    clearInterval(interval);
                    showTheaterRecommendations(horizon, risk);
                }
            }, 100);
        }

        function showTheaterRecommendations(horizon, risk) {
            const recommendations = [
                {
                    score: 0.8367,
                    name: 'Smart resource allocation',
                    summary: 'Wave 1: 2x IRIS-T (minimal). Preserve 45+ missiles for waves 2-5. Balance protection and capability preservation.',
                    cost: '$4-6M',
                    reserve: '68%',
                    coverage: 'All night'
                },
                {
                    score: 0.7891,
                    name: 'Prioritize critical assets',
                    summary: 'Priority: Odesa (energy infrastructure) + Kherson (command). Mykolaiv moderate defense. Accept risk on secondary targets.',
                    cost: '$3-5M',
                    reserve: '72%',
                    coverage: 'Until morning'
                },
                {
                    score: 0.7234,
                    name: 'Coordination with neighboring regions',
                    summary: 'Request support from Zaporizhzhia Air Defense. Load distribution. Joint defense of southern direction.',
                    cost: '$2-4M',
                    reserve: '80%',
                    coverage: 'Depends'
                }
            ];

            const container = document.getElementById('theater-recommendations');
            container.innerHTML = '';

            recommendations.forEach((rec, i) => {
                const div = document.createElement('div');
                div.className = 'theater-rec';
                div.onclick = () => selectTheaterRecommendation(rec, div);
                div.innerHTML = `
                    <div class="theater-rec-header">
                        <div class="theater-rec-name">${rec.name}</div>
                        <div class="theater-rec-score">${rec.score.toFixed(4)}</div>
                    </div>
                    <div class="theater-rec-summary">${rec.summary}</div>
                    <div class="theater-rec-meta">
                        <div class="theater-meta-item">
                            <div class="theater-meta-label">Cost</div>
                            <div class="theater-meta-value">${rec.cost}</div>
                        </div>
                        <div class="theater-meta-item">
                            <div class="theater-meta-label">Reserve</div>
                            <div class="theater-meta-value">${rec.reserve}</div>
                        </div>
                        <div class="theater-meta-item">
                            <div class="theater-meta-label">Coverage</div>
                            <div class="theater-meta-value">${rec.coverage}</div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });

            // Update UI
            document.getElementById('theater-loading').classList.add('hidden');
            document.querySelector('.theater-map').style.display = 'block';
            document.querySelector('.strategy-section').style.display = 'block';
        }

        function selectTheaterRecommendation(rec, element) {
            // Remove previous selection
            document.querySelectorAll('.theater-rec').forEach(el => {
                el.classList.remove('selected');
            });

            // Select new
            element.classList.add('selected');
            selectedTheaterRec = rec;

            // Show action panel
            document.getElementById('theater-action-panel').classList.add('visible');
            document.getElementById('theater-selected-strategy').textContent = rec.name;
        }

        function theaterViewDetails() {
            const detailTexts = [
                'STRATEGY DETAILS #1:\n\nRegional distribution:\n• Mykolaiv: 2x IRIS-T for wave 1\n• Odesa: RESERVE (40+ missiles)\n• Kherson: Coordination with EW\n\nTiming:\n• 23:15-00:00: Wave 1 (minimal resources)\n• 00:30-02:00: Wave 2 (main defense)\n• 02:00-06:00: Waves 3-5 (preserved reserve)\n\nExpected result:\n• 75-80% interception across all waves\n• 68% ammunition until morning',

                'STRATEGY DETAILS #2:\n\nPrioritization:\n• CRITICAL: Odesa (energy infrastructure)\n• HIGH: Kherson (command)\n• MEDIUM: Mykolaiv\n\nResources:\n• Odesa: 16x Patriot ready\n• Kherson: Buk-M1 + EW\n• Mykolaiv: Minimal defense\n\nRisks:\n• Possible losses in Mykolaiv\n• High political risk',

                'STRATEGY DETAILS #3:\n\nCoordination:\n• Request to Zaporizhzhia Air Defense\n• Joint radar\n• Target distribution\n\nExpected response: 15-20min\n\nAdvantages:\n• Saving resources\n• Higher effectiveness\n\nRisks:\n• Coordination delay\n• Dependency on neighbors'
            ];

            const idx = ['Smart resource allocation', 'Prioritize critical assets', 'Coordination with neighboring regions']
                .indexOf(selectedTheaterRec.name);

            alert(detailTexts[idx] || detailTexts[0]);
        }

        function theaterApproveDirective() {
            // Hide action panel
            document.getElementById('theater-action-panel').classList.remove('visible');

            // Show results
            document.querySelector('.theater-layout').style.display = 'none';
            document.getElementById('theater-results').classList.remove('hidden');

            // Fill results
            const results = [
                {
                    name: 'Smart resource allocation',
                    waves: '4/5 waves',
                    cost: '$4.2M',
                    reserve: '65%',
                    mykolaiv: '4/4 threats neutralized',
                    odesa: 'Reserve 72%',
                    kherson: 'Full defense active'
                },
                {
                    name: 'Prioritize critical assets',
                    waves: '3/5 waves',
                    cost: '$3.8M',
                    reserve: '70%',
                    mykolaiv: 'Partial coverage',
                    odesa: '100% protected',
                    kherson: '100% protected'
                },
                {
                    name: 'Coordination with neighboring regions',
                    waves: '4/5 waves',
                    cost: '$2.9M',
                    reserve: '78%',
                    mykolaiv: 'Zaporizhzhia Air Defense support',
                    odesa: 'Reserve maintained',
                    kherson: 'Joint radar'
                }
            ];

            const idx = ['Smart resource allocation', 'Prioritize critical assets', 'Coordination with neighboring regions']
                .indexOf(selectedTheaterRec.name);
            const result = results[idx] || results[0];

            document.getElementById('theater-result-waves').textContent = result.waves;
            document.getElementById('theater-result-cost').textContent = result.cost;
            document.getElementById('theater-result-reserve').textContent = result.reserve;
        }

        function closeTheaterResults() {
            document.getElementById('theater-results').classList.add('hidden');
            document.querySelector('.theater-layout').style.display = 'grid';
        }

        function resetTheater() {
            document.getElementById('theater-results').classList.add('hidden');
            document.querySelector('.theater-layout').style.display = 'grid';
            document.getElementById('theater-recommendations').innerHTML = `
                <div style="text-align: center; padding: 40px 20px; color: var(--gray); font-size: 12px;">
                    Click "Calculate Strategy"
                </div>
            `;
            selectedTheaterRec = null;
        }
    </script>
</body>
</html>
